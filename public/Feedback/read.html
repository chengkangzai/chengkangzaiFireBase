<!doctype html>
<html lang="en">

<head>
    <title>Feedback</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script src="https://www.gstatic.com/firebasejs/6.3.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/6.3.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/6.3.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/6.3.1/firebase-storage.js"></script>

    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Material+Icons">
    <link rel="stylesheet" href="//unpkg.com/bootstrap-material-design@4.1.1/dist/css/bootstrap-material-design.min.css">
    <link rel="stylesheet" href="../asset/css/particlejs.css" />
    <link rel="stylesheet" href="style.css" />

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
    <script src="https://unpkg.com/popper.js@1.12.6/dist/umd/popper.js"></script>
    <script src="https://unpkg.com/bootstrap-material-design@4.1.1/dist/js/bootstrap-material-design.js"></script>
</head>

<body>
    <div id="content-wrapper">
        <nav></nav>
        <div class="mt-5 text-center" id="tableContainer">
            <h2 class="text-white">Feedback List</h2>
            <div class="mx-auto text-center col-lg-10">
                <table class="table table-dark" id="feedback-list">
                    <thead>
                        <th>Feedback</th>
                        <th>Time</th>
                        <th>User</th>
                        <th>Action</th>
                    </thead>
                    <tbody id="FeedbackContainer">

                    </tbody>
                </table>
            </div>
            <a class="btn btn-primary mt-3" href="index.html" role="button">Back </a>
        </div>
    </div>

    <script src="../asset/js/particle.js "></script>
    <script src="../asset/js/nav.js"></script>
    <script src="../asset/js/fb.js "></script>
    <script>
        function renderFeedback(doc) {
            const data = doc.data();

            var timestamp, dom;
            (!data.timestamp) ? timestamp = "n/a":
                timestamp = new Date(data.timestamp.toDate()).toLocaleDateString('en-GB');

            (!data.user) ? username = "n/a":
                username = data.user;

            dom = `
                <tr id="${doc.id}">
                    <td>${data.feedback}</td>
                    <td>${timestamp}</td>
                    <td>${username}</td>
                    <td><a class="btn btn-danger text-white" onclick="deleteEntry('${doc.id}');">Delete </a></td>
                </tr>
    `;

            $('#feedback-list').append(dom);
            $('body').show();
        }

        function deleteEntry(docId) {
            db.collection("feedback").doc(docId).delete().then(function() {
                console.log("Document successfully deleted!");
                $("#" + docId).hide();
            }).catch(function(error) {
                console.error("Error removing document: ", error);
            });
        }

        db.collection('feedback').get().then(snapshot => {
            snapshot.docs.forEach(doc => {
                renderFeedback(doc);

            });
        }).catch(function(error) {
            if (error.code == "permission-denied") {
                window.location.href = "404.html";
            }
        });
    </script>
</body>

</html>